<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ESTP | Public Gateway</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="gateway-shell">
        <h1>PUBLIC ACCESS GATEWAY</h1>

        <section class="capacity-monitor red-line">
            <h2>Current System Capacity</h2>
            <div class="stat-box">
                <p id="room-display">Calculating Room...</p>
                <small id="cap-subtitle">Based on 10% of Sovereign Anchor</small>
            </div>
            <div class="progress-container" style="background: #222; border-radius: 5px; height: 10px; width: 100%;">
                <div id="progress-bar" style="background: var(--yellow); width: 0%; height: 100%; transition: 0.5s;"></div>
            </div>
        </section>

        <section class="action-gate yellow-line">
            <h3>Initiate 90-Day Lock (Token A â†’ Token B)</h3>
            <p>Enter the amount you wish to contribute to the current 6-hour heartbeat.</p>
            
            <div class="input-group">
                <input type="number" id="lock-amt" placeholder="Amount of Token A" oninput="validateInput()">
                <button id="lock-btn" onclick="executeLock()" disabled>INSUFFICIENT CAPACITY</button>
            </div>
            <p id="validation-msg" style="color: #888; font-size: 0.8rem; margin-top: 10px;"></p>
        </section>

        <section class="auto-send-log" id="log-section" style="display:none;">
            <h4 style="color: var(--green);">[SYSTEM] AUTO-SEND TRIGGERED</h4>
            <p id="auto-send-msg"></p>
        </section>
    </div>

    <script>
        // These values would be pulled from the Bank's Master Ledger in a live environment
        let anchorValue = 10000000; // The Blue Line
        let redLineLimit = anchorValue * 0.10; // 10% Max Capacity
        let currentUtilization = 850000; // Example: $850k already locked by public

        function updateUI() {
            const roomLeft = redLineLimit - currentUtilization;
            const percentage = (currentUtilization / redLineLimit) * 100;

            document.getElementById('room-display').innerText = `$${roomLeft.toLocaleString()} Remaining`;
            document.getElementById('progress-bar').style.width = percentage + "%";
            
            if (roomLeft <= 0) {
                document.getElementById('room-display').innerText = "SYSTEM MAXED";
                document.getElementById('room-display').style.color = "var(--red)";
            }
            return roomLeft;
        }

        function validateInput() {
            const inputAmt = parseFloat(document.getElementById('lock-amt').value);
            const roomLeft = updateUI();
            const btn = document.getElementById('lock-btn');
            const msg = document.getElementById('validation-msg');

            if (isNaN(inputAmt) || inputAmt <= 0) {
                btn.disabled = true;
                btn.innerText = "ENTER AMOUNT";
                msg.innerText = "";
            } else if (inputAmt > roomLeft) {
                btn.disabled = true;
                btn.innerText = "EXCEEDS CAPACITY";
                msg.innerText = `Error: You are attempting to lock $${inputAmt.toLocaleString()}, but only $${roomLeft.toLocaleString()} is available.`;
                msg.style.color = "var(--red)";
            } else {
                btn.disabled = false;
                btn.innerText = "LOCK & AUTO-SEND";
                btn.style.background = "var(--green)";
                msg.innerText = `Ready to lock. This will trigger an $${(inputAmt * 0.75).toLocaleString()} (75%) loan to Industrial Partners.`;
                msg.style.color = "var(--green)";
            }
        }

        function executeLock() {
            const inputAmt = parseFloat(document.getElementById('lock-amt').value);
            const loanAmt = inputAmt * 0.75;
            
            // Log the "Auto-Send" to show the bank it's instantaneous
            document.getElementById('log-section').style.display = "block";
            document.getElementById('auto-send-msg').innerText = 
                `Successfully locked $${inputAmt.toLocaleString()}. 
                Instruction sent to Wallet 2: Disburse $${loanAmt.toLocaleString()} ALI to Industrial Spending Accounts.`;
            
            currentUtilization += inputAmt;
            updateUI();
            validateInput();
        }

        // Initialize display
        updateUI();
    </script>
</body>
</html>
